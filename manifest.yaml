
id: ipfs-podcasting
title: "IPFS Podcasting"
version: 0.6.3.1
release-notes: "Initial Release for Start9/embassyOS"
license: gpl-3.0
wrapper-repo: "https://github.com/Cameron-IPFSPodcasting/podcastnode-Start9-wrapper"
upstream-repo: "https://github.com/Cameron-IPFSPodcasting/podcastnode-Start9-wrapper"
support-site: "https://github.com/Cameron-IPFSPodcasting/podcastnode-Start9-wrapper/issues"
marketing-site: "https://IPFSPodcasting.net/"
donation-url: "https://IPFSPodcasting.net/Contribute"
build: ["make"]

description:
  short: Crowd-host podcasts over IPFS
  long: |
    Run an IPFS node for self-hosting, crowd-hosting, and archiving of your favorite podcasts to the IPFS network. This service utilizes IPFSPodcasting.net to manage & track podcast episodes, and generate RSS feeds that load media from the IPFS network. Optionally configure your email to manage your node from the website.

assets:
  license: LICENSE
  icon: icon.png
  instructions: instructions.md

#docker-images: image.tar

main:
  type: docker
  image: main
  entrypoint: "docker_entrypoint.sh"
  args: []
  mounts:
    main: /ipfs-podcasting/ipfs

health-checks:
  web-ui:
    name: IPFS Network
    success-message: IPFS Network is Ready
    type: script

config:
  get:
   type: script
  set:
    type: script
properties:
  type: script

dependencies: {}

volumes:
  main:
    type: data

# IPFS webui is at /webui. tor address works only if you use http://tor-address.onion/webui 
# Can't figure out how to configure a path /webui (and lan url doesn't work at all)
interfaces:
  mgmt:
    name: IPFS UI
    description: Default IPFS UI
    tor-config:
      port-mapping:
        80: "5001"
    lan-config:
      5001:
        ssl: false
        internal: 5001
    ui: true
    protocols:
      - tcp
      - http
  ipfs:
    name: IPFS Network
    description: Port 4001 for IPFS network communication
    tor-config:
      port-mapping:
        4001: "4001"
    lan-config:
      4001:
        ssl: false
        internal: 4001
    ui: false
    protocols:
      - tcp
      - http

backup:
  create:
    type: docker
    image: compat
    system: true 
    entrypoint: compat 
    args:
      - duplicity
      - create
      - /mnt/backup
      - /ipfs-podcasting/ipfs
    mounts:
      BACKUP: "/mnt/backup" 
      main: "/ipfs-podcasting/ipfs"
    io-format: yaml
  restore:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - duplicity
      - restore
      - /mnt/backup
      - /ipfs-podcasting/ipfs
    mounts:
      BACKUP: "/mnt/backup"
      main: "/ipfs-podcasting/ipfs"
    io-format: yaml

# This is causing locking errors. "gc.sh" works inside the container,
# but this launches a new instance(?) that conflicts with the running instance.
# Is there an option to use the existing instance?
actions:
  cleanup:
    name: "Clean Up"
    description: "Runs garbage collection to clean up the IPFS datastore. This will remove old files that have been unpinned from IPFS."
#   warning: There is no warning. Future versions of the service will automatically run garbage collection when necessary.
    allowed-statuses:
      - running
      - stopped
    implementation:
      type: docker
      image: main
      entrypoint: gc.sh
      args: []
      mounts:
        main: /ipfs-podcasting/ipfs
      io-format: json

migrations:
  from:
    "*":
      type: script
      args: ["from"]
  to:
    "*":
      type: script
      args: ["to"]
